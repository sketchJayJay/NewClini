<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Anamnese - {{ patient.name }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    @media print{ .no-print{ display:none !important; } body{ background:#fff !important; } }
    .label{ color:#6c757d; font-size:.85rem; }
    .box{ border:1px solid #e5e7eb; border-radius:10px; padding:10px; }
  </style>
</head>
<body class="p-4">
  <div class="no-print mb-3">
    <button class="btn btn-outline-secondary" onclick="window.print()">Imprimir</button>
    <a class="btn btn-outline-secondary" href="{{ url_for('patients.anamnesis_view', pid=patient.id, aid=rec.id) }}">Voltar</a>
  </div>

  <h3 class="mb-0">Anamnese</h3>
  <div class="text-muted mb-3">Paciente: <b>{{ patient.name }}</b> · {{ sql_to_br(rec.created_at) }}</div>

  <div class="row g-3">
    <div class="col-md-6">
      <div class="box">
        <div class="label">Queixa principal</div>
        <div><b>{{ rec.queixa or "—" }}</b></div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="box">
        <div class="label">Profissional / Responsável</div>
        <div><b>{{ rec.responsavel or "—" }}</b></div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="box">
        <div class="label">Alergias</div>
        <div style="white-space:pre-wrap">{{ rec.alergias or "—" }}</div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="box">
        <div class="label">Medicamentos em uso</div>
        <div style="white-space:pre-wrap">{{ rec.medicamentos or "—" }}</div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="box">
        <div class="label">Doenças / Condições</div>
        <div style="white-space:pre-wrap">{{ rec.doencas or "—" }}</div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="box">
        <div class="label">Histórico médico (resumo)</div>
        <div style="white-space:pre-wrap">{{ rec.historico_medico or "—" }}</div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="box">
        <div class="label">Cirurgias / Procedimentos prévios</div>
        <div style="white-space:pre-wrap">{{ rec.cirurgias or "—" }}</div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="box">
        <div class="label">Reação a anestesia / medicamentos</div>
        <div style="white-space:pre-wrap">{{ rec.anestesia_reacao or "—" }}</div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="box">
        <div class="label">Sangramento / anticoagulantes</div>
        <div style="white-space:pre-wrap">{{ rec.sangramento or "—" }}</div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="box">
        <div class="label">Gestante</div>
        <div><b>{{ rec.gestante or "—" }}</b></div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="box">
        <div class="label">Fumante</div>
        <div><b>{{ rec.fumante or "—" }}</b></div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="box">
        <div class="label">Álcool</div>
        <div><b>{{ rec.alcool or "—" }}</b></div>
      </div>
    </div>

    <div class="col-12">
      <div class="box">
        <div class="label">Condições marcadas</div>
        <div>
          {% set labels = [] %}
          {% if rec.hipertensao %}{% set _ = labels.append('Hipertensão') %}{% endif %}
          {% if rec.diabetes %}{% set _ = labels.append('Diabetes') %}{% endif %}
          {% if rec.cardiaco %}{% set _ = labels.append('Cardíaco') %}{% endif %}
          {% if rec.hepatite %}{% set _ = labels.append('Hepatite') %}{% endif %}
          {% if rec.hiv %}{% set _ = labels.append('HIV') %}{% endif %}
          {% if labels|length %}{{ labels|join(', ') }}{% else %}—{% endif %}
        </div>
      </div>
    </div>

    <div class="col-12">
      <div class="box">
        <div class="label">Observações</div>
        <div style="white-space:pre-wrap">{{ rec.observacoes or "—" }}</div>
      </div>
    </div>
  </div>

  <div class="mt-4 small text-muted">
    * Documento gerado pelo NewClínica V2.
  </div>
</body>
</html>
